<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>file.js - lj-utils</title>
    
    <meta name="description" content="A clean, responsive documentation template theme for JSDoc 3." />
    
        <meta name="keywords" content="jsdoc, docdash,lj-utils" />
        <meta name="keyword" content="jsdoc, docdash,lj-utils" />
    
    
    
    <meta property="og:title" content="Docdash"/>
    <meta property="og:type" content="website"/>
    <meta property="og:image" content="https://cloud.githubusercontent.com/assets/447956/13398144/4dde7f36-defd-11e5-8909-1a9013302cb9.png"/>
    <meta property="og:site_name" content="Docdash"/>
    <meta property="og:url" content="http://clenemt.github.io/docdash/"/>
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/LinJieLinLin/utils" target="_blank" class="menu-item" id="Github" >Github repo</a></h2><h2><a href="https://gitee.com/uni-pro/utils" target="_blank" class="menu-item" id="Gitee" >Gitee repo</a></h2><h2><a href="../coverage/index.html" target="_blank" class="menu-item" id="coverage" >coverage</a></h2><h3>Classes</h3><ul><li><a href="-__awaiter.html">__awaiter</a></li><li><a href="CanvasClass_CanvasClass.html">CanvasClass#CanvasClass</a></li><li><a href="Counter.html">Counter</a><ul class='methods'><li data-type='method'><a href="Counter.html#setCount">setCount</a></li><li data-type='method'><a href="Counter.html#setMaxCount">setMaxCount</a></li><li data-type='method'><a href="Counter.html#start">start</a></li><li data-type='method'><a href="Counter.html#stop">stop</a></li></ul></li><li><a href="Debounce.html">Debounce</a><ul class='methods'><li data-type='method'><a href="Debounce.html#debounce">debounce</a></li></ul></li><li><a href="Loading.html">Loading</a><ul class='methods'><li data-type='method'><a href="Loading.html#loading">loading</a></li></ul></li><li><a href="Throttle.html">Throttle</a><ul class='methods'><li data-type='method'><a href="Throttle.html#throttle">throttle</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-encrypt_base64.html">encrypt/base64</a><ul class='methods'><li data-type='method'><a href="module-encrypt_base64.html#.deBase64">deBase64</a></li><li data-type='method'><a href="module-encrypt_base64.html#.decode">decode</a></li><li data-type='method'><a href="module-encrypt_base64.html#.enBase64">enBase64</a></li><li data-type='method'><a href="module-encrypt_base64.html#.encode">encode</a></li></ul></li><li><a href="module-encrypt_crypto.html">encrypt/crypto</a><ul class='methods'><li data-type='method'><a href="module-encrypt_crypto.html#.aesInit">aesInit</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.deAes">deAes</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.deBase64">deBase64</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.decode">decode</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.enAes">enAes</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.enBase64">enBase64</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.encode">encode</a></li><li data-type='method'><a href="module-encrypt_crypto.html#.md5">md5</a></li></ul></li><li><a href="module-index.html">index</a><ul class='methods'><li data-type='method'><a href="module-index.html#.blobToBase64">blobToBase64</a></li><li data-type='method'><a href="module-index.html#.blobToFile">blobToFile</a></li><li data-type='method'><a href="module-index.html#.blobUrlToFile">blobUrlToFile</a></li><li data-type='method'><a href="module-index.html#.dataURLtoBlob">dataURLtoBlob</a></li><li data-type='method'><a href="module-index.html#.decodeHtml">decodeHtml</a></li><li data-type='method'><a href="module-index.html#.delCookie">delCookie</a></li><li data-type='method'><a href="module-index.html#.dlFile">dlFile</a></li><li data-type='method'><a href="module-index.html#.encodeHtml">encodeHtml</a></li><li data-type='method'><a href="module-index.html#.formatNumber">formatNumber</a></li><li data-type='method'><a href="module-index.html#.formatSize">formatSize</a></li><li data-type='method'><a href="module-index.html#.formatTime">formatTime</a></li><li data-type='method'><a href="module-index.html#.friendlyTime">friendlyTime</a></li><li data-type='method'><a href="module-index.html#.getCookie">getCookie</a></li><li data-type='method'><a href="module-index.html#.getDuration">getDuration</a></li><li data-type='method'><a href="module-index.html#.getEnv">getEnv</a></li><li data-type='method'><a href="module-index.html#.getInfo">getInfo</a></li><li data-type='method'><a href="module-index.html#.getNetworkStatus">getNetworkStatus</a></li><li data-type='method'><a href="module-index.html#.getObj">getObj</a></li><li data-type='method'><a href="module-index.html#.getRandomColor">getRandomColor</a></li><li data-type='method'><a href="module-index.html#.getRegexp">getRegexp</a></li><li data-type='method'><a href="module-index.html#.getStorage">getStorage</a></li><li data-type='method'><a href="module-index.html#.getUrlParam">getUrlParam</a></li><li data-type='method'><a href="module-index.html#.getUrlParamObj">getUrlParamObj</a></li><li data-type='method'><a href="module-index.html#.getUuid">getUuid</a></li><li data-type='method'><a href="module-index.html#.hideInfo">hideInfo</a></li><li data-type='method'><a href="module-index.html#.isBlob">isBlob</a></li><li data-type='method'><a href="module-index.html#.isFile">isFile</a></li><li data-type='method'><a href="module-index.html#.isIdCard">isIdCard</a></li><li data-type='method'><a href="module-index.html#.isJson">isJson</a></li><li data-type='method'><a href="module-index.html#.isPrime">isPrime</a></li><li data-type='method'><a href="module-index.html#.loadFile">loadFile</a></li><li data-type='method'><a href="module-index.html#.px2vw">px2vw</a></li><li data-type='method'><a href="module-index.html#.randomInt">randomInt</a></li><li data-type='method'><a href="module-index.html#.remInit">remInit</a></li><li data-type='method'><a href="module-index.html#.replaceUrlParam">replaceUrlParam</a></li><li data-type='method'><a href="module-index.html#.rmbPrice">rmbPrice</a></li><li data-type='method'><a href="module-index.html#.safe">safe</a></li><li data-type='method'><a href="module-index.html#.safeData">safeData</a></li><li data-type='method'><a href="module-index.html#.secondToTime">secondToTime</a></li><li data-type='method'><a href="module-index.html#.setCookie">setCookie</a></li><li data-type='method'><a href="module-index.html#.setEnv">setEnv</a></li><li data-type='method'><a href="module-index.html#.setLog">setLog</a></li><li data-type='method'><a href="module-index.html#.setObj">setObj</a></li><li data-type='method'><a href="module-index.html#.setStorage">setStorage</a></li><li data-type='method'><a href="module-index.html#.setTitle">setTitle</a></li><li data-type='method'><a href="module-index.html#.setUrlParams">setUrlParams</a></li><li data-type='method'><a href="module-index.html#.sleep">sleep</a></li><li data-type='method'><a href="module-index.html#.string10to62">string10to62</a></li><li data-type='method'><a href="module-index.html#.string62to10">string62to10</a></li><li data-type='method'><a href="module-index.html#.toFixed">toFixed</a></li><li data-type='method'><a href="module-index.html#.toHump">toHump</a></li><li data-type='method'><a href="module-index.html#.toLine">toLine</a></li><li data-type='method'><a href="module-index.html#.toList">toList</a></li><li data-type='method'><a href="module-index.html#~blobToBase64">blobToBase64</a></li><li data-type='method'><a href="module-index.html#~blobToFile">blobToFile</a></li><li data-type='method'><a href="module-index.html#~blobUrlToFile">blobUrlToFile</a></li><li data-type='method'><a href="module-index.html#~dataURLtoBlob">dataURLtoBlob</a></li><li data-type='method'><a href="module-index.html#~decodeHtml">decodeHtml</a></li><li data-type='method'><a href="module-index.html#~delCookie">delCookie</a></li><li data-type='method'><a href="module-index.html#~dlFile">dlFile</a></li><li data-type='method'><a href="module-index.html#~encodeHtml">encodeHtml</a></li><li data-type='method'><a href="module-index.html#~formatNumber">formatNumber</a></li><li data-type='method'><a href="module-index.html#~formatSize">formatSize</a></li><li data-type='method'><a href="module-index.html#~formatTime">formatTime</a></li><li data-type='method'><a href="module-index.html#~friendlyTime">friendlyTime</a></li><li data-type='method'><a href="module-index.html#~getCookie">getCookie</a></li><li data-type='method'><a href="module-index.html#~getDuration">getDuration</a></li><li data-type='method'><a href="module-index.html#~getEnv">getEnv</a></li><li data-type='method'><a href="module-index.html#~getInfo">getInfo</a></li><li data-type='method'><a href="module-index.html#~getNetworkStatus">getNetworkStatus</a></li><li data-type='method'><a href="module-index.html#~getObj">getObj</a></li><li data-type='method'><a href="module-index.html#~getRandomColor">getRandomColor</a></li><li data-type='method'><a href="module-index.html#~getRegexp">getRegexp</a></li><li data-type='method'><a href="module-index.html#~getStorage">getStorage</a></li><li data-type='method'><a href="module-index.html#~getUrlParam">getUrlParam</a></li><li data-type='method'><a href="module-index.html#~getUrlParamObj">getUrlParamObj</a></li><li data-type='method'><a href="module-index.html#~getUuid">getUuid</a></li><li data-type='method'><a href="module-index.html#~hideInfo">hideInfo</a></li><li data-type='method'><a href="module-index.html#~isBlob">isBlob</a></li><li data-type='method'><a href="module-index.html#~isFile">isFile</a></li><li data-type='method'><a href="module-index.html#~isIdCard">isIdCard</a></li><li data-type='method'><a href="module-index.html#~isJson">isJson</a></li><li data-type='method'><a href="module-index.html#~isPrime">isPrime</a></li><li data-type='method'><a href="module-index.html#~loadFile">loadFile</a></li><li data-type='method'><a href="module-index.html#~px2vw">px2vw</a></li><li data-type='method'><a href="module-index.html#~randomInt">randomInt</a></li><li data-type='method'><a href="module-index.html#~remInit">remInit</a></li><li data-type='method'><a href="module-index.html#~replaceUrlParam">replaceUrlParam</a></li><li data-type='method'><a href="module-index.html#~rmbPrice">rmbPrice</a></li><li data-type='method'><a href="module-index.html#~safeData">safeData</a></li><li data-type='method'><a href="module-index.html#~secondToTime">secondToTime</a></li><li data-type='method'><a href="module-index.html#~setCookie">setCookie</a></li><li data-type='method'><a href="module-index.html#~setEnv">setEnv</a></li><li data-type='method'><a href="module-index.html#~setLog">setLog</a></li><li data-type='method'><a href="module-index.html#~setObj">setObj</a></li><li data-type='method'><a href="module-index.html#~setStorage">setStorage</a></li><li data-type='method'><a href="module-index.html#~setTitle">setTitle</a></li><li data-type='method'><a href="module-index.html#~setUrlParams">setUrlParams</a></li><li data-type='method'><a href="module-index.html#~sleep">sleep</a></li><li data-type='method'><a href="module-index.html#~string10to62">string10to62</a></li><li data-type='method'><a href="module-index.html#~string62to10">string62to10</a></li><li data-type='method'><a href="module-index.html#~toFixed">toFixed</a></li><li data-type='method'><a href="module-index.html#~toHump">toHump</a></li><li data-type='method'><a href="module-index.html#~toLine">toLine</a></li></ul></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li><a href="module-microApi.html">microApi</a><ul class='members'><li data-type='member'><a href="module-microApi.html#.APP">APP</a></li><li data-type='member'><a href="module-microApi.html#.getDom">getDom</a></li><li data-type='member'><a href="module-microApi.html#~interceptors">interceptors</a></li></ul><ul class='methods'><li data-type='method'><a href="module-microApi.html#.checkSetting">checkSetting</a></li><li data-type='method'><a href="module-microApi.html#.checkUpdate">checkUpdate</a></li><li data-type='method'><a href="module-microApi.html#.clearStorageSync">clearStorageSync</a></li><li data-type='method'><a href="module-microApi.html#.cloudApi">cloudApi</a></li><li data-type='method'><a href="module-microApi.html#.downloadImgs">downloadImgs</a></li><li data-type='method'><a href="module-microApi.html#.getCurrentPage">getCurrentPage</a></li><li data-type='method'><a href="module-microApi.html#.getCurrentPageUrl">getCurrentPageUrl</a></li><li data-type='method'><a href="module-microApi.html#.getDb">getDb</a></li><li data-type='method'><a href="module-microApi.html#.getLocation">getLocation</a></li><li data-type='method'><a href="module-microApi.html#.getRichText">getRichText</a></li><li data-type='method'><a href="module-microApi.html#.getStorage">getStorage</a></li><li data-type='method'><a href="module-microApi.html#.getStorageSync">getStorageSync</a></li><li data-type='method'><a href="module-microApi.html#.getSystemInfo">getSystemInfo</a></li><li data-type='method'><a href="module-microApi.html#.getUserInfo">getUserInfo</a></li><li data-type='method'><a href="module-microApi.html#.hideLoading">hideLoading</a></li><li data-type='method'><a href="module-microApi.html#.init">init</a></li><li data-type='method'><a href="module-microApi.html#.ljApiFn">ljApiFn</a></li><li data-type='method'><a href="module-microApi.html#.login">login</a></li><li data-type='method'><a href="module-microApi.html#.P">P</a></li><li data-type='method'><a href="module-microApi.html#.refresh">refresh</a></li><li data-type='method'><a href="module-microApi.html#.request">request</a></li><li data-type='method'><a href="module-microApi.html#.requestCloud">requestCloud</a></li><li data-type='method'><a href="module-microApi.html#.scrollTop">scrollTop</a></li><li data-type='method'><a href="module-microApi.html#.setRequest">setRequest</a></li><li data-type='method'><a href="module-microApi.html#.setStorage">setStorage</a></li><li data-type='method'><a href="module-microApi.html#.setTitle">setTitle</a></li><li data-type='method'><a href="module-microApi.html#.showLoading">showLoading</a></li><li data-type='method'><a href="module-microApi.html#.toast">toast</a></li><li data-type='method'><a href="module-microApi.html#.toPage">toPage</a></li><li data-type='method'><a href="module-microApi.html#.uploadImg">uploadImg</a></li><li data-type='method'><a href="module-microApi.html#.uploadImgs">uploadImgs</a></li><li data-type='method'><a href="module-microApi.html#.wxLog">wxLog</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">file.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module index
 * @author linjielinlin 993353454@qq.com
 * @date 2022-05-11 22:07:43
 * @description 文件相关处理
 */
var __awaiter = (this &amp;&amp; this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { safeData } from './base';
/**
 * 描述
 * @function
 * @description blob转base64
 * @date 2020-03-01
 * @param {Blob} argBlob 要处理的数据
 * @returns {Promise} 返回base64
 */
export const blobToBase64 = (argBlob) => __awaiter(void 0, void 0, void 0, function* () {
    // eslint-disable-next-line no-undef
    const fileReader = new FileReader();
    fileReader.readAsDataURL(argBlob);
    fileReader.onload = (e) => {
        return Promise.resolve(e &amp;&amp; e.target &amp;&amp; e.target.result);
    };
    fileReader.onerror = () => {
        return Promise.reject(new Error('文件流异常'));
    };
});
/**
 * 描述
 * @function
 * @description blobUrl 转 file文件
 * @date 2020-03-01
 * @param {string} argData blobUrl
 * @returns {Promise} 返回文件流
 */
export const blobUrlToFile = (argData) => __awaiter(void 0, void 0, void 0, function* () {
    return new Promise(function (resolve, reject) {
        // eslint-disable-next-line no-undef
        var xhr = new XMLHttpRequest();
        xhr.open('GET', argData, true);
        xhr.responseType = 'blob';
        xhr.onload = function (e) {
            if (this.status === 200) {
                return resolve(this.response);
            }
        };
        xhr.onerror = (err) => {
            return reject(err);
        };
        xhr.send();
    });
});
/**
 * @function
 * @description 图片dataUrl base64转blob对象
 * @param {string} argData dataUrl
 * @returns {Blob}
 */
export const dataURLtoBlob = (argData) => {
    if (!argData.match(/;base64,/)) {
        return new Blob();
    }
    let arr = argData.split(',');
    let mime = safeData(arr[0].match(/:(.*?);/), '1', '');
    if (!mime) {
        return new Blob();
    }
    let bstr = globalThis.atob(arr[1]);
    let n = bstr.length;
    let u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], { type: mime });
};
/**
 * @function
 * @description blob转file对象
 * @param {Blob} argBlob blob对像
 * @param {string} argName filename
 * @returns {File}
 */
export const blobToFile = (argBlob, argName = Date.now().toString()) => {
    let file = new File([argBlob], argName, {
        type: argBlob.type,
    });
    return file;
};
/**
 * @function
 * @description 下载文件
 * @param {string|Blob|File} argData blob对像/file对象/dataUrl/base64
 * @param {string} argName filename
 * @param {number} argDelTime 移除dateUrl时间
 */
export const dlFile = (argData, argName = Date.now().toString(), argDelTime = 10000) => {
    let downNode = globalThis.document.createElement('a');
    downNode.download = argName;
    // 字符内容转换为blob地址
    let href = '';
    if (typeof argData === 'string') {
        if (argData.startsWith('blob:')) {
            href = argData;
        }
        else if (argData.startsWith('data:image')) {
            href = argData;
        }
        argData = new Blob([argData]);
    }
    href = href || URL.createObjectURL(argData);
    downNode.href = href;
    setTimeout(() => {
        URL.revokeObjectURL(href);
    }, argDelTime);
    globalThis.document.body.appendChild(downNode);
    downNode.click();
    globalThis.document.body.removeChild(downNode);
};
/**
 * @function
 * @description 获取音视频时长
 * @param {Blob|File|string} argFile 音视频数据，string时为链接
 * @returns {Promise} 时长单位秒
 */
export const getDuration = (argFile) => __awaiter(void 0, void 0, void 0, function* () {
    let filePath;
    if (typeof argFile === 'string') {
        filePath = argFile;
    }
    else {
        filePath = URL.createObjectURL(argFile);
    }
    return new Promise((resolve, reject) => {
        const audio = new Audio(filePath);
        audio.addEventListener('loadedmetadata', function (e) {
            if (filePath.startsWith('blob:')) {
                URL.revokeObjectURL(filePath);
            }
            const duration = audio.duration;
            audio.src = '';
            return resolve(duration);
        });
        setTimeout(() => {
            return reject(new Error('读取时长超时'));
        }, 5000);
    });
});
/**
 * @function
 * @description 动态加载html文件标签
 * @param {string} argUrl 要加载的url
 * @param {string} argType 加载类型 js/css
 * @param {object} argOptions{
 * disCheck:'不检查是否有相同标签'
 * force:'如果有相同标签，先删除再添加'
 * } 是否强制添加
 * @return {Promise}
 */
export const loadFile = (argUrl, argType = 'js', argOptions = {}) => {
    let temId = argType + '-' + argUrl.split('/').pop();
    let head = globalThis.document.getElementsByTagName('head')[0];
    let nodeTag;
    if (!argOptions.disCheck) {
        let checkTag = globalThis.document.getElementById(temId);
        // 已经存在对应tag
        if (checkTag) {
            if (argOptions.force) {
                head.removeChild(checkTag);
            }
            else {
                return Promise.resolve({ msg: '已存在，中断加载！' });
            }
        }
    }
    switch (argType) {
        case 'css':
            nodeTag = globalThis.document.createElement('link');
            nodeTag.type = 'text/css';
            nodeTag.rel = 'stylesheet';
            nodeTag.href = argUrl;
            break;
        case 'js':
            nodeTag = globalThis.document.createElement('script');
            nodeTag.src = argUrl;
            nodeTag.type = 'text/javascript';
            break;
        default:
            console.error('暂不支持：' + argType);
            return Promise.reject({ msg: '暂不支持：' + argType });
    }
    nodeTag.id = temId;
    head.appendChild(nodeTag);
    return new Promise((resolve) => {
        if (nodeTag.readyState) {
            // ljTodo 2022-04-12 11:53:50
            // nodeTag.onreadystatechange = function () {
            //   if (
            //     nodeTag.readyState === 'loaded' ||
            //     nodeTag.readyState === 'complete'
            //   ) {
            //     nodeTag.onreadystatechange = null
            //     return resolve(argUrl)
            //   }
            // }
            ;
            nodeTag.onreadystatechange = function () {
                if (nodeTag.readyState === 'complete') {
                    ;
                    nodeTag.onreadystatechange = null;
                    return resolve(argUrl);
                }
            };
        }
        else {
            // Others
            nodeTag.onload = function () {
                return resolve(argUrl);
            };
        }
    });
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.11</a> on Thu Feb 16 2023 06:51:37 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



    <script src="scripts/baidu.js"></script>
    
</body>
</html>
